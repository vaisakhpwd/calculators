<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IS 10262:2019 Concrete Mix Design</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        /* Custom styles for better readability and structure */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
        }
        .container {
            max-width: 1200px;
        }
        .input-group label {
            font-weight: 500;
        }
        .input-field {
            border: 1px solid #d1d5db;
            padding: 10px;
            border-radius: 0.5rem;
            width: 100%;
            transition: all 0.2s;
        }
        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.4);
            outline: none;
        }
        .step-header {
            font-size: 1.125rem;
            font-weight: 600;
            color: #1f2937;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e5e7eb;
            margin-top: 1rem;
        }
        /* Style for the mix ratio display */
        .mix-ratio-ssd, .mix-ratio-field {
            font-size: 1.1rem;
            font-weight: 600;
            margin-top: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }
        
        /* -------------------------------------- */
        /* PDF Optimization Styles */
        /* -------------------------------------- */
        @media print {
            .no-print {
                display: none !important;
            }
            .lg\:col-span-2 {
                display: none !important;
            }
            #output-card {
                width: 100%;
                margin: 0;
                box-shadow: none;
                border: none;
                padding: 0;
            }
            .lg\:grid-cols-3 {
                display: block;
            }
            @page {
                size: A4;
                margin: 15mm;
            }
            body {
                padding: 0;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="container mx-auto">
        <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">IS 10262:2019 Concrete Mix Design Calculator</h1>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <div class="lg:col-span-2 p-6 rounded-lg shadow-xl border border-gray-200 no-print">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700">Design Inputs</h2>
                
                <form id="mixDesignForm" oninput="calculateMix()">
                    
                    <div class="mb-6">
                        <h3 class="step-header">General Information</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                            <div class="input-group">
                                <label for="grade" class="block text-sm text-gray-600">Grade of Concrete (e.g., M30)</label>
                                <input type="text" id="grade" class="input-field mt-1" value="M30" oninput="calculateMix()">
                            </div>
                            <div class="input-group">
                                <label for="design_date" class="block text-sm text-gray-600">Design Date (DD/MM/YYYY)</label>
                                <input type="text" id="design_date" class="input-field mt-1" value="01/01/2024">
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="step-header">Mix Properties (Steps 1-6)</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                            
                            <div class="input-group">
                                <label for="msa" class="block text-sm text-gray-600">Max. Size of Aggregate (mm)</label>
                                <select id="msa" class="input-field mt-1">
                                    <option value="10">10 mm</option>
                                    <option value="20" selected>20 mm</option>
                                    <option value="40">40 mm</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label for="slump" class="block text-sm text-gray-600">Target Slump (mm)</label>
                                <input type="number" id="slump" class="input-field mt-1" value="100" min="25">
                            </div>

                            <div class="input-group">
                                <label for="wcm_required" class="block text-sm text-gray-600">Required W/Cm Ratio</label>
                                <input type="number" id="wcm_required" class="input-field mt-1" value="0.45" step="0.01" min="0.25">
                            </div>
                            <div class="input-group">
                                <label for="cement_min" class="block text-sm text-gray-600">Min. Cement Content (kg/mÂ³)</label>
                                <input type="number" id="cement_min" class="input-field mt-1" value="320" min="250">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="step-header">Material Properties & FA Zone</h3>
                        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mt-4">
                            
                            <div class="input-group">
                                <label for="fa_zone" class="block text-sm text-gray-600">FA Grading Zone (Table 5)</label>
                                <select id="fa_zone" class="input-field mt-1">
                                    <option value="I">Zone I</option>
                                    <option value="II" selected>Zone II</option>
                                    <option value="III">Zone III</option>
                                    <option value="IV">Zone IV</option>
                                </select>
                            </div>

                            <div class="input-group">
                                <label for="sg_cement" class="block text-sm text-gray-600">SG of Cement</label>
                                <input type="number" id="sg_cement" class="input-field mt-1" value="3.15" step="0.01" min="1">
                            </div>
                            <div class="input-group">
                                <label for="sg_fa" class="block text-sm text-gray-600">SG of F.A. (SSD)</label>
                                <input type="number" id="sg_fa" class="input-field mt-1" value="2.65" step="0.01" min="1">
                            </div>
                            <div class="input-group">
                                <label for="sg_ca" class="block text-sm text-sm text-gray-600">SG of C.A. (SSD)</label>
                                <input type="number" id="sg_ca" class="input-field mt-1" value="2.75" step="0.01" min="1">
                            </div>
                            <div class="input-group">
                                <label for="sg_admixture" class="block text-sm text-gray-600">SG of Admixture</label>
                                <input type="number" id="sg_admixture" class="input-field mt-1" value="1.10" step="0.01" min="1">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                            <div class="input-group">
                                <label for="water_absorption_fa" class="block text-sm text-gray-600">F.A. Water Absorption (%)</label>
                                <input type="number" id="water_absorption_fa" class="input-field mt-1" value="1.0" step="0.1" min="0">
                            </div>
                            <div class="input-group">
                                <label for="water_absorption_ca" class="block text-sm text-gray-600">C.A. Water Absorption (%)</label>
                                <input type="number" id="water_absorption_ca" class="input-field mt-1" value="0.5" step="0.1" min="0">
                            </div>
                            <div class="input-group">
                                <label for="moisture_content_fa" class="block text-sm text-gray-600">F.A. Moisture Content (%)</label>
                                <input type="number" id="moisture_content_fa" class="input-field mt-1" value="5.0" step="0.1" min="0">
                            </div>
                            <div class="input-group">
                                <label for="moisture_content_ca" class="block text-sm text-gray-600">C.A. Moisture Content (%)</label>
                                <input type="number" id="moisture_content_ca" class="input-field mt-1" value="2.0" step="0.1" min="0">
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <h3 class="step-header">Admixture</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                            <div class="input-group">
                                <label for="admixture_type" class="block text-sm text-gray-600">Admixture Type</label>
                                <select id="admixture_type" class="input-field mt-1">
                                    <option value="none">None</option>
                                    <option value="super_plasticizer" selected>Super Plasticizer</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label for="water_reduction" class="block text-sm text-gray-600">Water Reduction (%)</label>
                                <input type="number" id="water_reduction" class="input-field mt-1" value="25" min="0" max="30">
                            </div>
                            <div class="input-group">
                                <label for="admixture_dosage" class="block text-sm text-gray-600">Dosage (% by mass of cement)</label>
                                <input type="number" id="admixture_dosage" class="input-field mt-1" value="1.0" step="0.1" min="0">
                            </div>
                            <div class="input-group">
                                <label for="pumpable" class="block text-sm text-gray-600">Pumpable Concrete?</label>
                                <select id="pumpable" class="input-field mt-1">
                                    <option value="no">No</option>
                                    <option value="yes">Yes (10% CA reduction)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                </form>
            </div>
            
            <div id="output-card" class="p-6 rounded-lg shadow-xl border border-gray-200">
                <h2 class="text-2xl font-semibold mb-4 text-gray-700">Mix Design Results</h2>
                
                <div id="results-summary" class="space-y-4">
                    <div class="p-4 rounded border">
                        <p class="font-semibold text-gray-700">Target Mean Strength ($f'_{ck}$):</p>
                        <p id="res_target_strength" class="text-2xl text-green-600 font-bold"></p>
                    </div>

                    <div class="p-4 rounded border">
                        <p class="font-semibold text-gray-700">Governing W/Cm Ratio:</p>
                        <p id="res_wcm_governing" class="text-2xl text-blue-600 font-bold"></p>
                    </div>
                    
                    <div class="p-4 rounded border">
                        <p class="font-semibold text-gray-700">Estimated Water Content (kg/mÂ³):</p>
                        <p id="res_water_content" class="text-2xl font-bold"></p>
                    </div>
                </div>

                <h3 class="step-header mt-6">SSD Mix Proportions (Design)</h3>
                <ul id="ssd-results-list" class="space-y-1 mt-4">
                    <li><span class="font-semibold">Cement:</span> <span id="res_cement_ssd">0.0</span> kg/mÂ³</li>
                    <li><span class="font-semibold">Water (Net):</span> <span id="res_water_net">0.0</span> kg/mÂ³</li>
                    <li><span class="font-semibold">Fine Aggregate (SSD):</span> <span id="res_fa_ssd">0.0</span> kg/mÂ³</li>
                    <li><span class="font-semibold">Coarse Aggregate (SSD):</span> <span id="res_ca_ssd">0.0</span> kg/mÂ³</li>
                    <li><span class="font-semibold">Admixture:</span> <span id="res_admixture">0.0</span> kg/mÂ³</li>
                </ul>
                <p class="mix-ratio-ssd text-blue-700">Mix Ratio (C:FA:CA) [SSD]: <span id="ratio_ssd">1 : 0.00 : 0.00</span></p>

                <h3 class="step-header mt-6">Field (Wet) Mix Proportions</h3>
                <ul id="field-results-list" class="space-y-1 mt-4">
                    <li><span class="font-semibold">Cement:</span> <span id="field_cement">0.0</span> kg/mÂ³</li>
                    <li><span class="font-semibold">Water (Adjusted):</span> <span id="field_water">0.0</span> kg/mÂ³</li>
                    <li><span class="font-semibold">Fine Aggregate (Wet):</span> <span id="field_fa">0.0</span> kg/mÂ³</li>
                    <li><span class="font-semibold">Coarse Aggregate (Wet):</span> <span id="field_ca">0.0</span> kg/mÂ³</li>
                </ul>
                <p class="mix-ratio-field text-green-700">Mix Ratio (C:FA:CA) [WET]: <span id="ratio_field">1 : 0.00 : 0.00</span></p>

                <div class="mt-8 space-y-2 no-print">
                    <button onclick="generateSummaryPdf()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition duration-200">
                        ðŸ“„ Generate Summary PDF
                    </button>
                    <button onclick="generateDetailedPdf()" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded transition duration-200">
                        ðŸ“‹ Generate Detailed PDF
                    </button>
                </div>
            </div>
            
        </div>
    </div>

    <script>
        // Data derived from IS 10262:2019
        
        // Table 2 - Standard Deviation (S) for Grades
        const STANDARD_DEVIATION = {
            'M10': 3.5, 'M15': 3.5, 'M20': 4.0, 'M25': 4.0,
            'M30': 5.0, 'M35': 5.0, 'M40': 5.0, 'M45': 5.0,
            'M50': 5.0, 'M55': 5.0, 'M60': 5.0, 'M65': 5.0
        };

        // Table 4 - Water Content per cubic metre of concrete (kg) for 25-50 mm slump
        const WATER_CONTENT = {
            '10': 208,
            '20': 186,
            '40': 165
        };
        
        // BASE Volume of Coarse Aggregate per unit volume of total aggregate (Vca/Vt)
        // Table 5, IS 10262:2019 (at W/Cm = 0.50, for Crushed Angular Aggregate)
        const BASE_CA_VOLUME_FRACTION = {
            '10': { 'I': 0.48, 'II': 0.50, 'III': 0.52, 'IV': 0.54 },
            '20': { 'I': 0.60, 'II': 0.62, 'III': 0.64, 'IV': 0.66 },
            '40': { 'I': 0.69, 'II': 0.71, 'III': 0.72, 'IV': 0.73 }
        };

        function round(number, decimals = 3) {
            return parseFloat(number.toFixed(decimals));
        }

        function calculateMix() {
            try {
                // ----------------------------------------------------
                // 1. Get Inputs
                // ----------------------------------------------------
                const grade_input = document.getElementById('grade').value.toUpperCase();
                const grade_val = parseInt(grade_input.substring(1));
                
                const msa = document.getElementById('msa').value;
                const slump = parseFloat(document.getElementById('slump').value);
                const wcm_required = parseFloat(document.getElementById('wcm_required').value);
                const cement_min = parseFloat(document.getElementById('cement_min').value);

                const sg_cement = parseFloat(document.getElementById('sg_cement').value);
                const sg_fa = parseFloat(document.getElementById('sg_fa').value);
                const sg_ca = parseFloat(document.getElementById('sg_ca').value);
                const sg_admixture = parseFloat(document.getElementById('sg_admixture').value);

                const fa_zone = document.getElementById('fa_zone').value; // NEW INPUT
                const pumpable = document.getElementById('pumpable').value;
                
                const absorption_fa = parseFloat(document.getElementById('water_absorption_fa').value) / 100;
                const absorption_ca = parseFloat(document.getElementById('water_absorption_ca').value) / 100;
                const moisture_fa = parseFloat(document.getElementById('moisture_content_fa').value) / 100;
                const moisture_ca = parseFloat(document.getElementById('moisture_content_ca').value) / 100;

                const admixture_type = document.getElementById('admixture_type').value;
                const water_reduction_percent = parseFloat(document.getElementById('water_reduction').value);
                const admixture_dosage_percent = parseFloat(document.getElementById('admixture_dosage').value);

                if (isNaN(grade_val) || grade_val < 10) {
                    throw new Error("Invalid Concrete Grade. Must be M10 or higher.");
                }

                // ----------------------------------------------------
                // 2. Target Mean Strength ($f'_{ck}$)
                // ----------------------------------------------------
                const s = STANDARD_DEVIATION[grade_input] || STANDARD_DEVIATION['M30']; 
                const target_strength = grade_val + (1.65 * s);
                document.getElementById('res_target_strength').textContent = `${round(target_strength, 2)} N/mmÂ²`;

                // ----------------------------------------------------
                // 3. Selection of Governing W/Cm Ratio
                // ----------------------------------------------------
                const governing_wcm = wcm_required; 
                document.getElementById('res_wcm_governing').textContent = round(governing_wcm, 2);

                // ----------------------------------------------------
                // 4. Selection of Water Content (W)
                // ----------------------------------------------------
                const base_water = WATER_CONTENT[msa];
                
                // Adjustment for slump (Clause 4.1, Table 4 Note 2)
                let slump_correction = 0;
                if (slump > 50) {
                    slump_correction = Math.ceil((slump - 50) / 25) * 0.03;
                }
                let water_content_slump_corrected = base_water * (1 + slump_correction);

                // Adjustment for admixture (Clause 4.2)
                let water_content_adjusted = water_content_slump_corrected;
                if (admixture_type === 'super_plasticizer') {
                    const reduction_factor = water_reduction_percent / 100;
                    water_content_adjusted = water_content_slump_corrected * (1 - reduction_factor);
                }
                document.getElementById('res_water_content').textContent = round(water_content_adjusted, 1);
                
                // ----------------------------------------------------
                // 5. Calculation of Cementitious Material Content (C)
                // ----------------------------------------------------
                const cementitious_content_calc = water_content_adjusted / governing_wcm;
                
                // Check against minimum cement content
                const cementitious_content = Math.max(cementitious_content_calc, cement_min);

                const cement_content = cementitious_content;

                // ----------------------------------------------------
                // 6. Calculation of Admixture Content (AD)
                // ----------------------------------------------------
                const admixture_content = (cement_content * admixture_dosage_percent / 100);

                // ----------------------------------------------------
                // 7. Determination of Aggregate Volume (Absolute Volume Method)
                // ----------------------------------------------------
                
                // Calculate the volume of non-aggregate components
                const V_cement = (cement_content / sg_cement) / 1000;
                const V_water = (water_content_adjusted / 1) / 1000;
                const V_admixture = (admixture_content / sg_admixture) / 1000;
                
                // Assuming 1% entrapped air for 20mm MSA (as per IS 10262)
                let V_air = 0.01;
                if (msa === '10') V_air = 0.02;
                if (msa === '40') V_air = 0.006;
                
                // Volume of all aggregates (for 1mÂ³ of concrete)
                const V_aggregate = 1 - (V_cement + V_water + V_admixture + V_air);

                // ----------------------------------------------------
                // 8. Splitting the Aggregate Volume (Vca/Vt) - USING FA ZONE INPUT
                // ----------------------------------------------------
                
                // 8a. Get the base Vca/Vt ratio (at W/Cm = 0.50) using MSA and FA Zone
                let Vca_Vt_base;
                try {
                    Vca_Vt_base = BASE_CA_VOLUME_FRACTION[msa][fa_zone];
                } catch (e) {
                    alert("Error: MSA/FA Zone combination missing from Table 5 data.");
                    return;
                }

                // 8b. Apply W/Cm correction (Clause 5.5.1)
                const WCM_REFERENCE = 0.50;
                const WCM_INTERVAL = 0.05;
                const CORRECTION_FACTOR = 0.01;

                const difference_in_wcm = WCM_REFERENCE - governing_wcm;
                const correction_multiplier = difference_in_wcm / WCM_INTERVAL;
                const Vca_Vt_correction = correction_multiplier * CORRECTION_FACTOR;

                let Vca_Vt_corrected = Vca_Vt_base + Vca_Vt_correction;
                
                // 8c. Apply Pumpable concrete reduction (10% reduction in CA volume)
                if (pumpable === 'yes') {
                    Vca_Vt_corrected *= 0.90; 
                }
                
                const Vca_Vt = round(Vca_Vt_corrected, 3);

                // Calculate individual volumes
                const Vca = V_aggregate * Vca_Vt; // Volume of Coarse Aggregate
                const Vfa = V_aggregate - Vca; // Volume of Fine Aggregate

                // ----------------------------------------------------
                // 9. Mix Calculations by Mass (SSD)
                // ----------------------------------------------------
                const FA_mass_ssd = Vfa * sg_fa * 1000;
                const CA_mass_ssd = Vca * sg_ca * 1000;

                // ----------------------------------------------------
                // 10. Field Corrections (Wet Basis)
                // ----------------------------------------------------
                
                // Water in/on aggregates
                const water_in_fa = FA_mass_ssd * moisture_fa;
                const water_in_ca = CA_mass_ssd * moisture_ca;
                
                // Water required for SSD condition (Absorption)
                const water_req_fa = FA_mass_ssd * absorption_fa;
                const water_req_ca = CA_mass_ssd * absorption_ca;

                // Net Free Water in aggregates (Negative means water is required, Positive means water is supplied)
                const net_water_from_fa = water_in_fa - water_req_fa;
                const net_water_from_ca = water_in_ca - water_req_ca;
                
                const total_net_water_from_agg = net_water_from_fa + net_water_from_ca;

                // Mass of aggregates in field (Wet mass)
                const FA_mass_field = FA_mass_ssd + net_water_from_fa;
                const CA_mass_field = CA_mass_ssd + net_water_from_ca;

                // Adjusted mixing water
                const water_mass_adjusted = water_content_adjusted - total_net_water_from_agg;


                // ----------------------------------------------------
                // 11. Display Results
                // ----------------------------------------------------
                
                // Display SSD (Design) Results
                document.getElementById('res_cement_ssd').textContent = round(cement_content).toFixed(1);
                document.getElementById('res_water_net').textContent = round(water_content_adjusted).toFixed(1);
                document.getElementById('res_fa_ssd').textContent = round(FA_mass_ssd).toFixed(1);
                document.getElementById('res_ca_ssd').textContent = round(CA_mass_ssd).toFixed(1);
                document.getElementById('res_admixture').textContent = round(admixture_content).toFixed(3);

                // SSD Mix Ratio
                const ratio_fa_ssd = FA_mass_ssd / cement_content;
                const ratio_ca_ssd = CA_mass_ssd / cement_content;
                document.getElementById('ratio_ssd').textContent = `1 : ${round(ratio_fa_ssd, 2).toFixed(2)} : ${round(ratio_ca_ssd, 2).toFixed(2)}`;

                // Display Field (Corrected) Results
                document.getElementById('field_cement').textContent = round(cement_content).toFixed(1); // Cement is batched dry
                document.getElementById('field_water').textContent = round(Math.max(0, water_mass_adjusted)).toFixed(1);
                document.getElementById('field_fa').textContent = round(FA_mass_field).toFixed(1);
                document.getElementById('field_ca').textContent = round(CA_mass_field).toFixed(1);

                // Field Mix Ratio
                const ratio_fa_field = FA_mass_field / cement_content;
                const ratio_ca_field = CA_mass_field / cement_content;
                document.getElementById('ratio_field').textContent = `1 : ${round(ratio_fa_field, 2).toFixed(2)} : ${round(ratio_ca_field, 2).toFixed(2)}`;
                
            } catch (error) {
                console.error("Calculation Error:", error.message);
                
                document.getElementById('res_target_strength').textContent = "---";
                document.getElementById('res_wcm_governing').textContent = "---";
                document.getElementById('res_water_content').textContent = "---";
                
                document.getElementById('res_cement_ssd').textContent = "ERROR";
                document.getElementById('res_water_net').textContent = "ERROR";
                document.getElementById('res_fa_ssd').textContent = "ERROR";
                document.getElementById('res_ca_ssd').textContent = "ERROR";
                document.getElementById('res_admixture').textContent = "ERROR";
                document.getElementById('ratio_ssd').textContent = "1 : - : -";

                document.getElementById('field_cement').textContent = "ERROR";
                document.getElementById('field_water').textContent = "ERROR";
                document.getElementById('field_fa').textContent = "ERROR";
                document.getElementById('field_ca').textContent = "ERROR";
                document.getElementById('ratio_field').textContent = "1 : - : -";
            }
        }

        // --- PDF GENERATION LOGIC ---

        const { jsPDF } = window.jspdf;

        function getReportData() {
            // Collect all inputs and outputs for reporting
            const data = {
                // Inputs
                Grade: document.getElementById('grade').value,
                Date: document.getElementById('design_date').value,
                MSA: document.getElementById('msa').value + ' mm',
                Slump: document.getElementById('slump').value + ' mm',
                WCM_Required: document.getElementById('wcm_required').value,
                FA_Zone: document.getElementById('fa_zone').value,
                Pumpable: document.getElementById('pumpable').value,
                
                SG_Cement: document.getElementById('sg_cement').value,
                SG_FA: document.getElementById('sg_fa').value,
                SG_CA: document.getElementById('sg_ca').value,
                Abs_FA: document.getElementById('water_absorption_fa').value + ' %',
                Abs_CA: document.getElementById('water_absorption_ca').value + ' %',
                Moist_FA: document.getElementById('moisture_content_fa').value + ' %',
                Moist_CA: document.getElementById('moisture_content_ca').value + ' %',

                // Summary Outputs
                Target_Strength: document.getElementById('res_target_strength').textContent,
                WCM_Governing: document.getElementById('res_wcm_governing').textContent,
                Water_Content_Net: document.getElementById('res_water_content').textContent + ' kg/mÂ³',

                // SSD Proportions
                SSD_Cement: document.getElementById('res_cement_ssd').textContent + ' kg/mÂ³',
                SSD_Water: document.getElementById('res_water_net').textContent + ' kg/mÂ³',
                SSD_FA: document.getElementById('res_fa_ssd').textContent + ' kg/mÂ³',
                SSD_CA: document.getElementById('res_ca_ssd').textContent + ' kg/mÂ³',
                SSD_Admixture: document.getElementById('res_admixture').textContent + ' kg/mÂ³',
                SSD_Ratio: document.getElementById('ratio_ssd').textContent,

                // Field Proportions
                Field_Cement: document.getElementById('field_cement').textContent + ' kg/mÂ³',
                Field_Water: document.getElementById('field_water').textContent + ' kg/mÂ³',
                Field_FA: document.getElementById('field_fa').textContent + ' kg/mÂ³',
                Field_CA: document.getElementById('field_ca').textContent + ' kg/mÂ³',
                Field_Ratio: document.getElementById('ratio_field').textContent
            };
            return data;
        }

        function generatePdf(type, filename) {
            const doc = new jsPDF();
            const data = getReportData();
            let y = 10;
            const margin = 10;
            
            // Header
            doc.setFontSize(16);
            doc.text(`Concrete Mix Design Report - Grade ${data.Grade}`, margin, y);
            y += 7;
            doc.setFontSize(10);
            doc.text(`Date: ${data.Date} | MSA: ${data.MSA} | FA Zone: ${data.FA_Zone}`, margin, y);
            y += 5;
            doc.line(margin, y, 200, y); // Horizontal line
            y += 5;
            
            // Summary Results
            doc.setFontSize(12);
            doc.text("Design Parameters & Results", margin, y);
            y += 5;
            
            doc.setFontSize(10);
            doc.text(`Target Mean Strength ($f'_{ck}$): ${data.Target_Strength}`, margin, y);
            doc.text(`Governing W/Cm Ratio: ${data.WCM_Governing}`, 100, y);
            y += 5;
            doc.text(`Estimated Net Water Content: ${data.Water_Content_Net}`, margin, y);
            doc.text(`Slump Required: ${data.Slump}`, 100, y);
            y += 5;

            // SSD Proportions Table
            y += 5;
            doc.setFontSize(12);
            doc.text("SSD Mix Proportions (Design)", margin, y);
            y += 5;

            let ssdTableData = [
                ['Material', 'Quantity (kg/mÂ³)', 'Ratio (C:FA:CA)'],
                ['Cement', data.SSD_Cement.split(' ')[0], '1.00'],
                ['Water (Net)', data.SSD_Water.split(' ')[0], ''],
                ['Fine Aggregate (SSD)', data.SSD_FA.split(' ')[0], data.SSD_Ratio.split(' : ')[1]],
                ['Coarse Aggregate (SSD)', data.SSD_CA.split(' ')[0], data.SSD_Ratio.split(' : ')[2]],
                ['Admixture', data.SSD_Admixture.split(' ')[0], '']
            ];

            doc.autoTable({
                startY: y,
                head: [ssdTableData[0]],
                body: ssdTableData.slice(1),
                theme: 'grid',
                styles: { fontSize: 9, cellPadding: 1 },
                headStyles: { fillColor: [200, 200, 200], textColor: [0, 0, 0] },
                didDrawPage: (data) => {
                    y = data.cursor.y + 2;
                }
            });

            // Field Proportions Table
            y = doc.autoTable.previous.finalY + 5;
            doc.setFontSize(12);
            doc.text("Field (Wet) Mix Proportions", margin, y);
            y += 5;

            let fieldTableData = [
                ['Material', 'Quantity (kg/mÂ³)', 'Ratio (C:FA:CA)'],
                ['Cement', data.Field_Cement.split(' ')[0], '1.00'],
                ['Water (Adjusted)', data.Field_Water.split(' ')[0], ''],
                ['Fine Aggregate (Wet)', data.Field_FA.split(' ')[0], data.Field_Ratio.split(' : ')[1]],
                ['Coarse Aggregate (Wet)', data.Field_CA.split(' ')[0], data.Field_Ratio.split(' : ')[2]]
            ];

            doc.autoTable({
                startY: y,
                head: [fieldTableData[0]],
                body: fieldTableData.slice(1),
                theme: 'grid',
                styles: { fontSize: 9, cellPadding: 1 },
                headStyles: { fillColor: [200, 200, 200], textColor: [0, 0, 0] },
                didDrawPage: (data) => {
                    y = data.cursor.y + 2;
                }
            });
            y = doc.autoTable.previous.finalY + 5;

            // Optional Detailed Section (for Detailed PDF)
            if (type === 'detailed') {
                doc.addPage();
                y = margin;
                doc.setFontSize(14);
                doc.text("Detailed Material Inputs", margin, y);
                y += 5;
                
                doc.setFontSize(10);
                doc.text(`SG Cement: ${data.SG_Cement}`, margin, y);
                doc.text(`SG Fine Aggregate: ${data.SG_FA}`, 70, y);
                doc.text(`SG Coarse Aggregate: ${data.SG_CA}`, 130, y);
                y += 5;
                doc.text(`FA Absorption: ${data.Abs_FA}`, margin, y);
                doc.text(`CA Absorption: ${data.Abs_CA}`, 70, y);
                y += 5;
                doc.text(`FA Moisture: ${data.Moist_FA}`, margin, y);
                doc.text(`CA Moisture: ${data.Moist_CA}`, 70, y);
                y += 5;
            }

            doc.save(filename);
        }

        function generateSummaryPdf() {
            // Need to load jsPDF-autotable plugin for autoTable function
            if (typeof doc.autoTable === 'undefined') {
                alert("Please ensure jsPDF Autotable is loaded for PDF generation.");
                return;
            }
            generatePdf('summary', 'Mix_Design_Summary.pdf');
        }

        function generateDetailedPdf() {
             if (typeof doc.autoTable === 'undefined') {
                alert("Please ensure jsPDF Autotable is loaded for PDF generation.");
                return;
            }
            generatePdf('detailed', 'Mix_Design_Detailed_Calculations.pdf');
        }
        
        // Run calculation and set default date on load
        window.onload = () => {
            const dateInput = document.getElementById('design_date');
            if (!dateInput.value) {
                const now = new Date();
                const day = String(now.getDate()).padStart(2, '0');
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const year = now.getFullYear();
                dateInput.value = `${day}/${month}/${year}`;
            }
            calculateMix();
        };

    </script>
</body>
</html>
